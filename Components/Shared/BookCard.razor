@using BookHeaven.Server.Helpers
<MudCard Elevation="4"
         Class="@CardClass"
         @onclick="HandleBookClick">

	@if (IsSelectMode)
	{
		<span class="absolute bottom-3 right-2 size-5 @(IsSelected ? "bg-(--mud-palette-tertiary)" : "bg-white") border border-2 border-(--mud-palette-primary) z-10 rounded-full flex items-center justify-center animate-flip-in-x animate-iteration-count-once animate-duration-300">
			@if (IsSelected)
			{
				<MudIcon Icon="@Icons.Material.Filled.Check" Class="text-xs"/>
			}
		</span>
	}
	<div class="h-[250px] overflow-hidden">
		<span class="h-full" style="@Transitions.GetTransitionName("img", Book.BookId)">
			<MudCardMedia Image="@Book.CoverUrl(true)" Class="transition-transform !h-full duration-150 group-hover:scale-105"/>
		</span>
	</div>
	<MudCardContent
		Class="flex-1 relative flex flex-col gap-1 transition-colors group-hover:bg-slate-700">
		<MudText Typo="Typo.body2"><span style="@Transitions.GetTransitionName("title", Book.BookId)">@Book.Title</span></MudText>
		<MudText Typo="Typo.body2" Color="Color.Secondary"><span style="@Transitions.GetTransitionName("author", Book.BookId)">@Book.Author?.Name</span></MudText>
		<MudText Typo="Typo.caption" Color="Color.Primary"><span style="@Transitions.GetTransitionName("series", Book.BookId)">@Book.Series?.Name</span></MudText>
		@if (Book.Progresses.Any())
		{
			<span class="absolute z-10 bottom-0 inset-x-0" style="@Transitions.GetTransitionName("progress-bar", Book.BookId)">
				<MudProgressLinear
					Color="Color.Primary"
					Size="Size.Small"
					Value="@((double)Book.Progress().Progress)"/>
			</span>
		}
	</MudCardContent>
</MudCard>

@code {
	[Parameter] public required Book Book { get; set; }
	[Parameter] public bool IsInteractive { get; set; } = true;
	[Parameter] public bool IsSelectMode { get; set; } = false;
	[Parameter] public bool IsSelected { get; set; } = false;
	[Parameter] public EventCallback<(Guid id, bool shiftPressed)> OnBookClicked { get; set; }
	
	private string CardClass => $"relative overflow-hidden flex flex-col select-none {(!IsInteractive ? "pointer-events-none" : "group hover:cursor-pointer active:scale-95 transition-transform ")}";
	
	private async Task HandleBookClick(MouseEventArgs e)
	{
		if (!IsInteractive)
			return;

		await OnBookClicked.InvokeAsync((Book.BookId, e.ShiftKey));
	}
}